{"version":3,"sources":["../src/wiki-converter.js"],"names":["Promise","require","fs","path","defaults","GWCMarkdown","GWCHtmlWriter","GWCPdfWriter","GWCToc","GWCFinder","helpers","logger","WikiConverter","constructor","wiki_path","options","statSync","isDirectory","TypeError","wikiPath","computePaths","computeOptions","computeCssFiles","computeJsFiles","checkTocLevel","checkOutputFormat","generate","self","resolve","reject","searchMarkdownFiles","then","result","mdFiles","files","mdAliases","aliases","markdownConverter","toc","copyAssets","promises","getOption","indexOf","htmlWriter","push","write","pdfWriter","all","catch","bind","computePages","pages","getItems","forEach","item","title","file","pageId","html","convertMarkdownFile","getPages","getMarkdownConverter","getMarkdownFiles","getToc","assetsPath","join","__dirname","cssPath","imagesPath","htmlPath","cssFiles","highlightTheme","userCssFile","jsFiles","userJsFile","assetsFiles","getJsFiles","concat","getCssFiles","copySync","basename","def","logoImage","footer","pdfPageCount","format","filename","output","tocFile","searchForFile","tocLevel","verbose","transports","console","level","debug","parseInt","setOption","key","value","getTocFile","addCssFile","Object","defineProperty","module","exports"],"mappings":"AAAA,aAEA,GAAIA,SAAUC,QAAQ,UAAR,CAAd,CACIC,GAAKD,QAAQ,UAAR,CADT,CAEIE,KAAOF,QAAQ,MAAR,CAFX,CAGIG,SAAWH,QAAQ,UAAR,CAHf,CAIII,YAAcJ,QAAQ,YAAR,CAJlB,CAKIK,cAAgBL,QAAQ,eAAR,CALpB,CAMIM,aAAeN,QAAQ,cAAR,CANnB,CAOIO,OAASP,QAAQ,OAAR,CAPb,CAQIQ,UAAYR,QAAQ,UAAR,CARhB,CASIS,QAAUT,QAAQ,WAAR,CATd,CAUIU,OAASV,QAAQ,UAAR,CAVb,CAYA,KAAMW,cAAc,CAClB;;;;;;KAOAC,YAAYC,CAAZ,CAAuBC,CAAvB,CAAgC,CAE9B,GAAI,CAACD,CAAD,EAAc,QAAGE,QAAH,CAAYF,CAAZ,EAAuBG,WAAvB,EAAlB,CACE,KAAM,IAAIC,UAAJ,CAAc,qCAAd,CAAN,CAGF,KAAKC,QAAL,CAAgBL,CANc,CAO9B,KAAKM,YAAL,GACKC,cADL,CACoBN,CADpB,EAEKO,eAFL,GAGKC,cAHL,GAIKC,aAJL,GAKKC,iBALL,EAMD,CAEDC,UAAW,CAET,GAAIC,GAAO,IAAX,CAEA,MAAO,IAAI3B,QAAJ,CAAY,SAAS4B,CAAT,CAAkBC,CAAlB,CAA0B,CAE3CpB,UAAUqB,mBAAV,CAA8BH,EAAKR,QAAnC,EAA6CY,IAA7C,CAAkD,SAAUC,CAAV,CAAkB,CAClE,KAAKC,OAAL,CAAeD,EAAOE,KAD4C,CAElE,KAAKC,SAAL,CAAiBH,EAAOI,OAF0C,CAIlE,KAAKC,iBAAL,CAAyB,GAAIhC,YAAJ,CAAgB,KAAKc,QAArB,CAA+B,KAAKgB,SAApC,CAJyC,CAKlE,KAAKG,GAAL,CAAW,GAAI9B,OAAJ,CAAWmB,CAAX,CALuD,CAOlE,KAAKY,UAAL,EAPkE,CASlE,GAAIC,GAAW,EAAf,CAYA,MAV+C,EAA5C,OAAKC,SAAL,CAAe,QAAf,EAAyBC,OAAzB,CAAiC,MAAjC,CAUH,GATE,KAAKC,UAAL,CAAkB,GAAIrC,cAAJ,CAAkB,IAAlB,CASpB,CAREkC,EAASI,IAAT,CAAc,KAAKD,UAAL,CAAgBE,KAAhB,EAAd,CAQF,EAL8C,CAA3C,OAAKJ,SAAL,CAAe,QAAf,EAAyBC,OAAzB,CAAiC,KAAjC,CAKH,GAJE,KAAKI,SAAL,CAAiB,GAAIvC,aAAJ,CAAiB,IAAjB,CAInB,CAHEiC,EAASI,IAAT,CAAc,KAAKE,SAAL,CAAeD,KAAf,EAAd,CAGF,EAAO7C,QAAQ+C,GAAR,CAAYP,CAAZ,EAAsBT,IAAtB,CAA2BH,CAA3B,EAAoCoB,KAApC,CAA0CnB,CAA1C,CAER,CAvBiD,CAuBhDoB,IAvBgD,CAuB3C,IAvB2C,CAAlD,CAwBD,CA1BkB,CA0BjBA,IA1BiB,CA0BZ,IA1BY,CAAZ,CA2BR,CAED;;;KAIAC,cAAe,CASb,MARA,MAAKC,KAAL,CAAa,EAQb,CAPA,KAAKb,GAAL,CAASc,QAAT,GAAoBC,OAApB,CAA4BC,GAAQ,CAClC,KAAKH,KAAL,CAAWP,IAAX,CAAgB,CACdW,MAAOD,EAAKC,KADE,CAEdC,KAAM,KAAKrB,SAAL,CAAemB,EAAKG,MAApB,CAFQ,CAGdC,KAAM,KAAKrB,iBAAL,CAAuBsB,mBAAvB,CAA2C,KAAKxB,SAAL,CAAemB,EAAKG,MAApB,CAA3C,CAHQ,CAAhB,CAKD,CAND,CAMG,IANH,CAOA,CAAO,IACR,CAEDG,UAAW,CAIT,MAHK,MAAKT,KAGV,EAFE,KAAKD,YAAL,EAEF,CAAO,KAAKC,KACb,CAEDU,sBAAuB,CACrB,MAAO,MAAKxB,iBACb,CAEDyB,kBAAmB,CACjB,MAAO,MAAK7B,OACb,CAED8B,QAAS,CACP,MAAO,MAAKzB,GACb,CAED;;;KAIAlB,cAAe,CAKb,MAJA,MAAK4C,UAAL,CAAkB7D,KAAKyB,OAAL,CAAazB,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,QAA3B,CAAb,CAIlB,CAHA,KAAKC,OAAL,CAAehE,KAAK8D,IAAL,CAAU,KAAKD,UAAf,CAA2B,KAA3B,CAGf,CAFA,KAAKI,UAAL,CAAkBjE,KAAK8D,IAAL,CAAU,KAAKD,UAAf,CAA2B,QAA3B,CAElB,CADA,KAAKK,QAAL,CAAgBlE,KAAK8D,IAAL,CAAU,KAAKD,UAAf,CAA2B,MAA3B,CAChB,CAAO,IACR,CAED;;;KAIA1C,iBAAkB,CAUhB,MARA,MAAKgD,QAAL,CAAgB,CACdnE,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,cAA3B,CAA2C,WAA3C,CAAwD,MAAxD,CAAgE,KAAhE,CAAuE,mBAAvE,CADc,CAEd/D,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,cAA3B,CAA2C,cAA3C,CAA2D,QAA3D,CAAqE,aAArE,CAFc,CAGd/D,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,cAA3B,CAA2C,cAA3C,CAA2D,QAA3D,CAAqE,KAAKnD,OAAL,CAAawD,cAAb,CAA8B,MAAnG,CAHc,CAIdpE,KAAK8D,IAAL,CAAU,KAAKE,OAAf,CAAwB,SAAxB,CAJc,CAQhB,CADA,KAAKpD,OAAL,CAAayD,WAAb,EAA4B,KAAKF,QAAL,CAAc1B,IAAd,CAAmBzC,KAAKyB,OAAL,CAAa,KAAKb,OAAL,CAAayD,WAA1B,CAAnB,CAC5B,CAAO,IACR,CAED;;;KAIAjD,gBAAiB,CAQf,MANA,MAAKkD,OAAL,CAAe,CACbtE,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,cAA3B,CAA2C,QAA3C,CAAqD,MAArD,CAA6D,eAA7D,CADa,CAEb/D,KAAK8D,IAAL,CAAUC,SAAV,CAAqB,IAArB,CAA2B,cAA3B,CAA2C,WAA3C,CAAwD,MAAxD,CAAgE,IAAhE,CAAsE,kBAAtE,CAFa,CAMf,CADA,KAAKnD,OAAL,CAAa2D,UAAb,EAA2B,KAAKD,OAAL,CAAa7B,IAAb,CAAkBzC,KAAKyB,OAAL,CAAa,KAAKb,OAAL,CAAa2D,UAA1B,CAAlB,CAC3B,CAAO,IACR,CAEDnC,YAAa,CACX,GAAK,KAAKE,SAAL,CAAe,qBAAf,CAAL,EAGA,GAAIkC,GAAc,KAAKC,UAAL,GAAkBC,MAAlB,CAAyB,KAAKC,WAAL,EAAzB,CAAlB,CAEAH,EAAYtB,OAAZ,CAAoB,SAASG,CAAT,CAAe,CACjCtD,GAAG6E,QAAH,CAAYvB,CAAZ,CAAkBrD,KAAK8D,IAAL,CAAU,KAAKxB,SAAL,CAAe,QAAf,CAAV,CAAoCtC,KAAK6E,QAAL,CAAcxB,CAAd,CAApC,CAAlB,CACD,CAFD,CAEG,IAFH,CALA,CAQD,CAEDnC,eAAeN,CAAf,CAAwB,CAEtB,GAAIkE,GAAM,CACR1B,MAAQ,eADA,CAER2B,UAAW,IAFH,CAGRC,OAAQ,IAHA,CAIRC,aAAc,IAJN,CAKRC,OAAS,MALD,CAMRC,SAAW,eANH,CAORC,OAASpF,KAAKyB,OAAL,CAAa,IAAb,CAPD,CAQR4D,QAAU/E,UAAUgF,aAAV,CAAwB,CAAC,WAAD,CAAc,eAAd,CAA+B,SAA/B,CAA0C,aAA1C,CAAxB,CAAkF,KAAKtE,QAAvF,CARF,CASRuE,SAAW,CATH,CASM;AACdnB,eAAiB,QAVT,CAWRC,YAAc,IAXN,CAAV,CAsBA,MARA,MAAKzD,OAAL,CAAeX,SAASW,CAAT,CAAkBkE,CAAlB,CAQf,CANI,KAAKlE,OAAL,CAAa4E,OAMjB,GALEhF,OAAOiF,UAAP,CAAkBC,OAAlB,CAA0BC,KAA1B,CAAkC,OAKpC,EAFAnF,OAAOoF,KAAP,CAAa,2BAAb,CAA0C,KAAKhF,OAA/C,CAEA,CAAO,IACR,CAED;;;;KAKAU,mBAAoB,OACU,KAAxB,QAAKV,OAAL,CAAasE,MADC,CAER,KAAKtE,OAAL,CAAasE,MAAb,CAAsB,CAAC,MAAD,CAAS,KAAT,CAFd,EAIlB,KAAKtE,OAAL,CAAasE,MAAb,CAAsB,CAAC,KAAKtE,OAAL,CAAasE,MAAd,CAJJ,CAKX,IALW,CAMnB,CAED7D,eAAgB,CAKd,MAJA,MAAKT,OAAL,CAAa2E,QAAb,CAAwBM,SAAS,KAAKjF,OAAL,CAAa2E,QAAtB,CAAgC,EAAhC,CAIxB,EAH4B,CAAxB,MAAK3E,OAAL,CAAa2E,QAAb,EAAqD,CAAxB,MAAK3E,OAAL,CAAa2E,QAG9C,IAFE,KAAK3E,OAAL,CAAa2E,QAAb,CAAwB,CAE1B,EAAO,IACR,CAEDO,UAAUC,CAAV,CAAeC,CAAf,CAAsB,CAEpB,MADA,MAAKpF,OAAL,CAAamF,CAAb,EAAoBC,CACpB,CAAO,IACR,CAED1D,UAAUyD,CAAV,CAAe,CACb,MAAO,MAAKnF,OAAL,CAAamF,CAAb,CACR,CAEDE,YAAa,CACX,MAAO,MAAK3D,SAAL,CAAe,SAAf,CACR,CAED4D,WAAW7C,CAAX,CAAiB,CAEf,MADA,MAAKc,QAAL,CAAc1B,IAAd,CAAmBzC,KAAKyB,OAAL,CAAa4B,CAAb,CAAnB,CACA,CAAO,IACR,CAEDsB,aAAc,CACZ,MAAO,MAAKR,QACb,CAEDM,YAAa,CACX,MAAO,MAAKH,OACb,CA1NiB,CA6NpB6B,OAAOC,cAAP,CAAsB3F,aAAtB,CAAqC,SAArC,CAAgD,CAC9CuF,MAAQlG,QAAQ,YAAR,CADsC,CAAhD,C,CAIAuG,OAAOC,OAAP,CAAiB7F,a","file":"wiki-converter.js","sourcesContent":["\"use strict\"\n\nvar Promise = require(\"bluebird\")\n  , fs = require('fs-extra')\n  , path = require('path')\n  , defaults = require('defaults')\n  , GWCMarkdown = require('./markdown')\n  , GWCHtmlWriter = require('./html-writer')\n  , GWCPdfWriter = require('./pdf-writer')\n  , GWCToc = require('./toc')\n  , GWCFinder = require('./finder')\n  , helpers = require('./helpers')\n  , logger = require('./logger')\n\nclass WikiConverter {\n  /**\n   * GWC Constructor\n   *\n   * @param {string} wiki_path wiki path\n   * @param {object} options options object\n   * @constructor\n   */\n  constructor(wiki_path, options) {\n\n    if (!wiki_path || fs.statSync(wiki_path).isDirectory() === false) {\n      throw new TypeError('wiki_path is not a valid directory.')\n    }\n\n    this.wikiPath = wiki_path\n    this.computePaths()\n        .computeOptions(options)\n        .computeCssFiles()\n        .computeJsFiles()\n        .checkTocLevel()\n        .checkOutputFormat()\n  }\n\n  generate() {\n\n    var self = this\n\n    return new Promise(function(resolve, reject) {\n\n      GWCFinder.searchMarkdownFiles(self.wikiPath).then(function (result) {\n        this.mdFiles = result.files\n        this.mdAliases = result.aliases\n\n        this.markdownConverter = new GWCMarkdown(this.wikiPath, this.mdAliases)\n        this.toc = new GWCToc(self)\n\n        this.copyAssets()\n\n        var promises = []\n\n        if(this.getOption('format').indexOf('html') >= 0) {\n          this.htmlWriter = new GWCHtmlWriter(this)\n          promises.push(this.htmlWriter.write())\n        }\n\n        if(this.getOption('format').indexOf('pdf') >= 0) {\n          this.pdfWriter = new GWCPdfWriter(this)\n          promises.push(this.pdfWriter.write())\n        }\n\n        return Promise.all(promises).then(resolve).catch(reject)\n\n      }.bind(this))\n    }.bind(this))\n  }\n\n  /**\n   * @private\n   * @returns {wiki-converter}\n   */\n  computePages() {\n    this.pages = []\n    this.toc.getItems().forEach(item => {\n      this.pages.push({\n        title: item.title,\n        file: this.mdAliases[item.pageId],\n        html: this.markdownConverter.convertMarkdownFile(this.mdAliases[item.pageId])\n      })\n    }, this)\n    return this\n  }\n\n  getPages() {\n    if (!this.pages) {\n      this.computePages()\n    }\n    return this.pages\n  }\n\n  getMarkdownConverter() {\n    return this.markdownConverter\n  }\n\n  getMarkdownFiles() {\n    return this.mdFiles\n  }\n\n  getToc() {\n    return this.toc\n  }\n\n  /**\n   * @private\n   * @returns {wiki-converter}\n   */\n  computePaths() {\n    this.assetsPath = path.resolve(path.join(__dirname, '..', 'assets'))\n    this.cssPath = path.join(this.assetsPath, 'css')\n    this.imagesPath = path.join(this.assetsPath, 'images')\n    this.htmlPath = path.join(this.assetsPath, 'html')\n    return this\n  }\n\n  /**\n   * @private\n   * @returns {wiki-converter}\n   */\n  computeCssFiles() {\n\n    this.cssFiles = [\n      path.join(__dirname, '..', 'node_modules', 'bootstrap', 'dist', 'css', 'bootstrap.min.css'),\n      path.join(__dirname, '..', 'node_modules', 'highlight.js', 'styles', 'default.css'),\n      path.join(__dirname, '..', 'node_modules', 'highlight.js', 'styles', this.options.highlightTheme + '.css'),\n      path.join(this.cssPath, 'doc.css')\n    ]\n\n    this.options.userCssFile && this.cssFiles.push(path.resolve(this.options.userCssFile))\n    return this\n  }\n\n  /**\n   * @private\n   * @returns {wiki-converter}\n   */\n  computeJsFiles() {\n\n    this.jsFiles = [\n      path.join(__dirname, '..', 'node_modules', 'jquery', 'dist', 'jquery.min.js'),\n      path.join(__dirname, '..', 'node_modules', 'bootstrap', 'dist', 'js', 'bootstrap.min.js')\n    ]\n\n    this.options.userJsFile && this.jsFiles.push(path.resolve(this.options.userJsFile))\n    return this\n  }\n\n  copyAssets() {\n    if (!this.getOption('disableInlineAssets')) {\n      return\n    }\n    var assetsFiles = this.getJsFiles().concat(this.getCssFiles())\n\n    assetsFiles.forEach(function(file) {\n      fs.copySync(file, path.join(this.getOption('output'), path.basename(file)))\n    }, this)\n  }\n\n  computeOptions(options) {\n\n    var def = {\n      title : 'Documentation',\n      logoImage: null,\n      footer: null,\n      pdfPageCount: null,\n      format : 'html',\n      filename : 'documentation',\n      output : path.resolve('./'),\n      tocFile : GWCFinder.searchForFile(['_Toc.html', '_Sidebar.html', '_Toc.md', '_Sidebar.md'], this.wikiPath),\n      tocLevel : 3, // between 1 and 4\n      highlightTheme : 'github',\n      userCssFile : null\n    }\n\n    this.options = defaults(options, def)\n\n    if (this.options.verbose) {\n      logger.transports.console.level = 'debug'\n    }\n\n    logger.debug(\"gwc launched with options\", this.options)\n\n    return this\n  }\n\n  /**\n   * Transform the format string into an array containing one to two elements\n   *\n   * @returns {string[]}\n   */\n  checkOutputFormat() {\n    if (this.options.format === 'all') {\n      return (this.options.format = ['html', 'pdf'])\n    }\n    this.options.format = [this.options.format]\n    return this\n  }\n\n  checkTocLevel() {\n    this.options.tocLevel = parseInt(this.options.tocLevel, 10)\n    if (this.options.tocLevel < 1 || this.options.tocLevel > 4) {\n      this.options.tocLevel = 3\n    }\n    return this\n  }\n\n  setOption(key, value) {\n    this.options[key] = value\n    return this\n  }\n\n  getOption(key) {\n    return this.options[key]\n  }\n\n  getTocFile() {\n    return this.getOption('tocFile')\n  }\n\n  addCssFile(file) {\n    this.cssFiles.push(path.resolve(file))\n    return this\n  }\n\n  getCssFiles() {\n    return this.cssFiles\n  }\n\n  getJsFiles() {\n    return this.jsFiles\n  }\n}\n\nObject.defineProperty(WikiConverter, 'package', {\n  value : require('../package')\n})\n\nmodule.exports = WikiConverter\n"]}